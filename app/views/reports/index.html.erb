<% content_for :header do %>Reporting and Stats<% end %>
<div class="reports collection-list">
  <!-- Pending Reservations -->
  <h2 class="collapsible pending_reservations">Pending Reservations - <%= @assets.collect{|a| a.reservations_pending}.flatten.length %></h2>
  <div class="pending_reservations pending_reservations-target">
	<% unless @libraries.blank? %>
	  <% @libraries.each do |library| %>
	    <h2><%= library.name %></h2>
	      <% unless library.reservable_asset_types.blank? %>
	        <% library.reservable_asset_types.each do |rat| %>
			<h3 class="collapsible asset_type"><%= rat.name %> - <%= rat.reservable_assets.collect{|a| a.reservations_pending}.flatten.length %></h3>
			<ul class="asset_type asset_type-target">
			  <% unless rat.reservable_assets.blank? %>
			    <% rat.reservable_assets.each do |ra| %>
				  <% unless ra.reservations_pending.blank? %>
				    <h3>Asset: <%= link_to(ra.name, ra) %></h3>
				    <%= render :partial => 'shared/lines/reservation', :collection => ra.reservations_pending %>
				  <% end %>
			    <% end %>
			  <% else %>
			    <li class="empty">No pending reservations.</li>
			  <% end %>
			</ul>
          <% end %>
        <% end %>
      <% end %>
    <% end %>
  </div>

	<!-- Expired Reservations -->
	<h2 class="collapsible expired_reservations">Recently Expired Reservations - <%= @assets.collect{|a| a.reservations_recently_expired}.flatten.length %></h2>
	<div class="expired_reservations expired_reservations-target">
	  	<% unless @libraries.blank? %>
		  <% @libraries.each do |library| %>
		    <h2><%= library.name %></h2>
		      <% unless library.reservable_asset_types.blank? %>
		        <% library.reservable_asset_types.each do |rat| %>
				<h3 class="collapsible asset_type_3"><%= rat.name %> - <%= rat.reservable_assets.collect{|a| a.reservations_recently_expired}.flatten.length %></h3>
				<ul class="asset_type_3 asset_type_3-target">
				  <% unless rat.reservable_assets.blank? %>
				    <% rat.reservable_assets.each do |ra| %>
					  <% unless ra.reservations_recently_expired.blank? %>
					    <h3><%= ra.name %></h3>
					    <%= render :partial => 'shared/lines/reservation', :collection => ra.reservations_recently_expired %>
					  <% end %>
				    <% end %>
				  <% else %>
				    <li class="empty">No recently expired reservations.</li>
				  <% end %>
				</ul>
	          <% end %>
	        <% end %>
	      <% end %>
	    <% end %>
	</div>

</div>
